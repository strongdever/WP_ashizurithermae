!function(e){e(document).on("sowsetupformfield",".siteorigin-widget-field-type-autocomplete",(function(t){var i=e(this),n=i.find(" .existing-content-selector");if(!i.data("initialized")){var a=function(){var e=i.find("input.siteorigin-widget-input").val();return 0===e.length?[]:e.split(",")},s=function(){var t=a();i.find("ul.items > li").each((function(i,n){var a=e(this);t.indexOf(a.data("value"))>-1?a.addClass("selected"):a.removeClass("selected")}))},l=function(){var t=i.find(".content-text-search"),n=t.val(),a=t.data("source"),s=t.data("postTypes"),l={action:"so_widgets_search_"+a};"posts"===a?(l.query=n,l.postTypes=s):"terms"===a&&(l.term=n),"string"==typeof icl_this_lang&&(l.language=icl_this_lang);var o=i.find("ul.items").empty().addClass("loading");return e.get(soWidgets.ajaxurl,l,(function(t){t.forEach((function(t){""===t.label&&(t.label="&nbsp;"),o.append(e("<li>").html(t.label+"<span>("+t.type+")</span>").data(t))})),o.removeClass("loading")}))};i.find(".siteorigin-widget-autocomplete-input").on("click",(function(){n.show();var t=new e.Deferred;n.is(":visible")&&0===n.find("ul.items li").length?t=l():t.resolve(),t.done(s)}));var o=function(){n.hide()};e(window).on("mousedown",(function(e){0===i.find(e.target).length&&o()})),i.find(".button-close").on("click",o),i.on("click keypress",".items li",(function(t){if(t.preventDefault(),"keyup"!=t.type||window.sowbForms.isEnter(t)){var s=i.find("input.siteorigin-widget-input"),l=e(this),d=l.data("value");if(n.data("multiple")){var r=a(),c=r.indexOf(d);c>-1?(r.splice(c,1),l.removeClass("selected")):(r.push(d),l.addClass("selected")),s.val(r.join(","))}else l.parent().find(".selected").removeClass("selected"),l.addClass("selected"),s.val(d),o();s.trigger("change")}}));var d=null;i.find(".content-text-search").on("keyup",(function(){null!==d&&clearTimeout(d),d=setTimeout((function(){l()}),500)})),i.data("initialized",!0)}}))}(jQuery);